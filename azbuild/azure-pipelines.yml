name: azbuild-$(Date:yyyyMMdd)$(Rev:.r)
trigger:
  paths:
    include:
      - azbuild/*

parameters:
  - name: Image
    displayName: Agent Pool
    type: string
    default: Pittsburgh
    values:
      - Pittsburgh
      - ubuntu-latest
      - macOS-latest


stages:
- stage: Build
  jobs:
  - job: BuildDocker
- ${{ if eq(parameters['Image'], 'Pittsburgh') }}:
    pool:
      name: Pittsburgh
- ${{ if ne(parameters['Image'], 'Pittsburgh') }}:
    pool:
      vmImage: ${{parameters['Image']}}
    steps:
    - task: Docker@2
      displayName: Docker Login
      inputs:
        containerRegistry: 'DockerHub'
        command: 'login'
        addPipelineData: false
        addBaseImageData: false

    - script: cd azbuild && ./build.sh lawisnie/azbuild $(Build.BuildNumber)
      displayName: Build & Push Image
      #failOnStderr: true